<!DOCTYPE html>
<html lang="VI">
<head>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMS | H·ªÜ TH·ªêNG QU·∫¢N L√ù B·ªÜNH VI·ªÜN NH√ÇN D√ÇN</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* M√ÄU CH·ª¶ ƒê·∫†O L·∫§Y T·ª™ ·∫¢NH */
            --MINT-DARK: #689F38; /* Xanh l√° ƒë·∫≠m */
            --MINT-LIGHT: #8BC34A; /* Xanh l√° s√°ng */
            --GOLD-TEXT: #DAA520; /* M√†u ch·ªØ slogan */
            --TEXT-COLOR: #333;
            --TEXT-MUTED: #666;
            --BORDER-COLOR: #E0E0E0;
            --SHADOW-SOFT: 0 2px 4px rgba(0, 0, 0, 0.1);
            
            /* M√ÄU NH·∫§N */
            --ACCENT-MINT: #4CAF50; 
            --ACCENT-SKY: #03A9F4; 
            --CONSOLE-BG: #2A2A2A;
            --CONSOLE-TEXT: #90EE90; /* D√πng cho log success/info */
            --RED-DANGER: #D32F2F;
            --YELLOW-WARN: #FBC02D;
        }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--TEXT-COLOR);
        }
        
        .CONTAINER-BM {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Styles cho n√∫t h√†nh ƒë·ªông */
        .ACTION-BTN-BM {
            padding: 8px 15px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .BG-MINT-ACCENT { background-color: var(--MINT-DARK); }
        .BG-MINT-ACCENT:hover { background-color: var(--MINT-LIGHT); }
        .BG-SKY-ACCENT { background-color: var(--ACCENT-SKY); }
        .BG-SKY-ACCENT:hover { background-color: #0288D1; }
        .BG-RED-PASTEL { background-color: var(--RED-DANGER); }
        .BG-RED-PASTEL:hover { background-color: #C62828; }

        /* HEADER, NAV, BANNER - GI·ªÆ NGUY√äN */
        .HEADER-TOP-BM { background-color: var(--MINT-DARK); height: 40px; display: flex; justify-content: flex-end; align-items: center; }
        .TOP-LINK-BM { color: white; padding: 5px 15px; font-size: 0.9em; text-decoration: none; }
        .APPOINTMENT-BTN { background-color: var(--MINT-LIGHT); border-radius: 4px; font-weight: 500; margin-right: 15px; }
        .APPOINTMENT-BTN:hover { background-color: var(--MINT-DARK); }
        .HEADER-MIDDLE-BM { padding: 15px 0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); background-color: white; }
        .HOSPITAL-BRAND-BM { display: flex; align-items: center; }
        .LOGO-ICON-BM { color: var(--MINT-DARK); font-size: 2.5em; margin-right: 10px; }
        .HOSPITAL-NAME-BM { font-size: 1.4em; font-weight: 600; color: var(--MINT-DARK); }
        .BRAND-SLOGAN-BM { font-family: 'Dancing Script', cursive; font-size: 1.2em; color: var(--GOLD-TEXT); margin-top: 5px; margin-left: 20px; }
        .SEARCH-BOX-BM { display: flex; align-items: center; border: 1px solid var(--MINT-DARK); border-radius: 25px; overflow: hidden; height: 40px; }
        .SEARCH-INPUT-BM { padding: 10px 15px; border: none; outline: none; width: 200px; font-size: 0.9em; text-transform: none; }
        .SEARCH-BTN-BM { background-color: var(--MINT-DARK); color: white; border: none; padding: 10px 15px; cursor: pointer; height: 100%; }
        .SEARCH-BTN-BM:hover { background-color: var(--MINT-LIGHT); }
        .HEADER-NAV-BM { background-color: white; border-top: 1px solid var(--BORDER-COLOR); }
        .CONTAINER-NAV-BM { list-style: none; margin: 0; padding: 0; display: flex; justify-content: center; }
        .NAV-ITEM-BM A { text-decoration: none; color: var(--TEXT-COLOR); padding: 15px 20px; display: block; font-weight: 500; transition: color 0.3s, border-bottom 0.3s; border-bottom: 3px solid transparent; }
        .NAV-ITEM-BM.active A { color: var(--MINT-DARK); border-bottom: 3px solid var(--MINT-DARK); }
        .NAV-ITEM-BM A:hover { color: var(--MINT-DARK); }
        .MAIN-CONTENT-BACKGROUND { background-image: url('https://image.luatvietnam.vn/uploaded/1200x675twebp/images/original/2020/12/24/benh-vien_2808175558_2412092857.jpg'); background-size: cover; background-position: center 50%; height: 300px; position: relative; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin-bottom: 20px; display: flex; align-items: center; justify-content: center; }
        .IMAGE-OVERLAY { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(104, 159, 56, 0.3); } 
        .WELCOME-TITLE-WRAPPER { position: relative; z-index: 20; text-align: center; background-color: rgba(51, 51, 51, 0.65); color: white; padding: 10px 40px; border-radius: 5px; box-shadow: 0 0 15px rgba(0, 0, 0, 0.5); }
        .WELCOME-TITLE { color: white; font-size: 2.5em; font-weight: 700; }
        .SERVICE-GRID-BM { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-top: -50px; position: relative; z-index: 10; }
        .SERVICE-CARD-BM { text-align: center; padding: 20px 10px; background-color: white; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .SERVICE-ICON-BM { font-size: 2em; margin-bottom: 5px; }
        .SERVICE-TITLE-BM { display: block; font-size: 1em; font-weight: 600; color: var(--MINT-DARK); margin-bottom: 3px; text-transform: uppercase; }
        .SERVICE-DETAIL-BM { display: block; font-size: 0.8em; color: var(--TEXT-MUTED); text-transform: none; }
        .MAIN-CONTENT-WRAPPER-BM { padding-bottom: 30px; background-color: #f9fafb; }
        .CONTENT-AREA-BM { padding-top: 30px; }
        .PAGE-TITLE-BM { color: var(--MINT-DARK); font-size: 1.5em; margin-bottom: 20px; font-weight: 600; }

        /* CUSTOM STYLE CHO LOG DISPLAY M·ªöI */
        #GlobalLogDisplay {
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            background-color: #F0F4F8; /* N·ªÅn s√°ng h∆°n */
            border: 1px solid #D9E2EC;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            max-height: 250px; /* Gi·ªõi h·∫°n chi·ªÅu cao */
            overflow-y: auto; /* Th√™m thanh cu·ªôn khi c·∫ßn */
        }
        
        .log-entry {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            padding: 4px 8px;
            margin-bottom: 2px;
            border-radius: 3px;
            line-height: 1.3;
            text-transform: none;
        }

        .log-info { 
            color: var(--TEXT-COLOR); /* Th√¥ng tin chung/API call */
            background-color: transparent;
        }
        
        .log-success { 
            color: #008000; /* Th√¥ng b√°o th√†nh c√¥ng */
            background-color: #E6FFE6;
            border-left: 4px solid #00A000;
            font-weight: 500;
        }

        .log-warning {
            color: var(--YELLOW-WARN); /* C·∫£nh b√°o nh·∫≠p li·ªáu */
            background-color: #FFFDE7;
            border-left: 4px solid var(--YELLOW-WARN);
        }

        .log-error {
            color: var(--RED-DANGER); /* L·ªói m·∫°ng/API */
            background-color: #FFEEEE;
            border-left: 4px solid var(--RED-DANGER);
            font-weight: 700;
        }

    </style>
</head>
<body class="bg-gray-50">

    <header class="MAIN-HEADER-BM sticky top-0 z-50">
        <div class="HEADER-TOP-BM">
            <div class="CONTAINER-BM flex justify-end items-center h-full">
                <a href="#" class="TOP-LINK-BM PHONE-CALL">
                    <i class="FAS FA-PHONE-ALT"></i> G·ªåI T·ªîNG ƒê√ÄI 1900.111.111
                </a>
                <a href="#" class="TOP-LINK-BM APPOINTMENT-BTN">
                    ƒê·∫∂T L·ªäCH KH√ÅM
                </a>
            </div>
        </div>

        <div class="HEADER-MIDDLE-BM">
            <div class="CONTAINER-BM flex justify-between items-center">
                
                <div class="HOSPITAL-BRAND-BM">
                    <i class="fas fa-hospital-symbol LOGO-ICON-BM"></i>
                    <div class="BRAND-INFO-BM">
                        <span class="HOSPITAL-NAME-BM">B·ªÜNH VI·ªÜN NH√ÇN D√ÇN</span>
                        <span class="BRAND-SLOGAN-BM FANCY-TEXT">V√å S·ª®C KH·ªé·∫∫ NH√ÇN D√ÇN</span>
                    </div>
                </div>

                <div class="SEARCH-BOX-BM">
                    <input type="text" placeholder="T√åM KI·∫æM..." class="SEARCH-INPUT-BM" id="GLOBAL_SEARCH_INPUT">
                    <button class="SEARCH-BTN-BM" onclick="SEARCH_GLOBAL()"><i class="FAS FA-SEARCH"></i></button>
                </div>
            </div>
        </div>

        <nav class="HEADER-NAV-BM">
            <ul class="CONTAINER-NAV-BM">
                <li class="NAV-ITEM-BM active"><a href="#" onclick="LOADPAGE('DOCTOR')">QU·∫¢N L√ù B√ÅC Sƒ®</a></li>
                <li class="NAV-ITEM-BM"><a href="#" onclick="LOADPAGE('NURSE')">QU·∫¢N L√ù Y T√Å</a></li>
                <li class="NAV-ITEM-BM"><a href="#" onclick="LOADPAGE('PATIENT')">QU·∫¢N L√ù B·ªÜNH NH√ÇN</a></li>
                <li class="NAV-ITEM-BM"><a href="#" onclick="LOADPAGE('APPOINTMENT')">QU·∫¢N L√ù L·ªäCH H·∫∏N</a></li>
                <li class="NAV-ITEM-BM"><a href="#" onclick="LOADPAGE('TREATMENT')">QU·∫¢N L√ù ƒêI·ªÄU TR·ªä</a></li>
                <li class="NAV-ITEM-BM"><a href="#" onclick="ALERT('ƒê√É ƒêƒÇNG XU·∫§T.')">THO√ÅT</a></li>
            </ul>
        </nav>
    </header>

    <div class="MAIN-CONTENT-WRAPPER-BM">
        
        <div class="MAIN-CONTENT-BACKGROUND">
            <div class="IMAGE-OVERLAY"></div> 
            <div class="WELCOME-TITLE-WRAPPER">
                <h1 class="WELCOME-TITLE">H·ªÜ TH·ªêNG QU·∫¢N L√ù D·ªäCH V·ª§ Y T·∫æ</h1>
            </div>
        </div>
        
        <div class="SERVICE-QUICK-LINKS-BM">
            <div class="CONTAINER-BM SERVICE-GRID-BM">
                <div class="SERVICE-CARD-BM">
                    <i class="fas fa-phone-volume SERVICE-ICON-BM" style="color: var(--ACCENT-MINT);"></i>
                    <span class="SERVICE-TITLE-BM">G·ªåI T·ªîNG ƒê√ÄI</span>
                    <span class="SERVICE-DETAIL-BM">ƒê·∫∂T L·ªäCH KH√ÅM NHANH QUA T·ªîNG ƒê√ÄI</span>
                </div>
                <div class="SERVICE-CARD-BM">
                    <i class="fas fa-calendar-check SERVICE-ICON-BM" style="color: var(--ACCENT-SKY);"></i>
                    <span class="SERVICE-TITLE-BM">ƒê·∫∂T L·ªäCH KH√ÅM</span>
                    <span class="SERVICE-DETAIL-BM">ƒê·∫∂T L·ªäCH KH√ÅM ONLINE T·∫†I WEBSITE</span>
                </div>
                <div class="SERVICE-CARD-BM">
                    <i class="fas fa-user-md SERVICE-ICON-BM" style="color: #FFB74D;"></i>
                    <span class="SERVICE-TITLE-BM">H·ªéI ƒê√ÅP CHUY√äN GIA</span>
                    <span class="SERVICE-DETAIL-BM">GI·∫¢I ƒê√ÅP TH·∫ÆC M·∫ÆC V·ªÄ S·ª®C KH·ªéE</span>
                </div>
                <div class="SERVICE-CARD-BM">
                    <i class="fas fa-file-medical-alt SERVICE-ICON-BM" style="color: #7986CB;"></i>
                    <span class="SERVICE-TITLE-BM">K·∫æT QU·∫¢ X√âT NGHI·ªÜM</span>
                    <span class="SERVICE-DETAIL-BM">TRA C·ª®U K·∫æT QU·∫¢ X√âT NGHI·ªÜM C·ª¶A B·∫†N</span>
                </div>
            </div>
        </div>
        
        <div id="CONTENT-AREA-BM" class="CONTENT-AREA-BM CONTAINER-BM">
            
            <h1 class="PAGE-TITLE-BM">H·ªÜ TH·ªêNG QU·∫¢N L√ù B·ªÜNH VI·ªÜN (HMS)</h1>
            
            <div class="ACTION-INPUT-AREA flex flex-wrap items-center gap-4 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <label class="font-semibold text-gray-700">ID/T·ª™ KH√ìA:</label>
                <input type="text" id="action_id_input" placeholder="NH·∫¨P ID HO·∫∂C T·ª™ KH√ìA T√åM KI·∫æM" class="p-2 border border-gray-300 rounded-md w-80 text-sm">
                <span class="text-xs text-gray-500">S·ª≠ d·ª•ng √¥ n√†y cho T√¨m ki·∫øm (3), X√≥a (4) v√† C·∫≠p nh·∫≠t (5).</span>
            </div>
            
            <div id="MAIN_FUNCTION_AREA">
                </div>
            
            <div id="DataDisplayArea">
                 <h2 class="PAGE-TITLE-BM mt-8 border-b border-gray-300 pb-2">üìä D·ªÆ LI·ªÜU HI·ªÜN T·∫†I</h2>
                 <p id="DataDisplayTitle" class="text-sm mb-4 text-gray-600">Ch·ªçn ch·ª©c nƒÉng ƒë·ªÉ xem danh s√°ch ho·∫∑c k·∫øt qu·∫£.</p>
                 <div id="DataDisplayContent">
                     <p class="text-gray-500 mt-4 p-4 bg-white rounded-lg border">Vui l√≤ng ch·ªçn m·ªôt ch·ª©c nƒÉng qu·∫£n l√Ω t·ª´ menu tr√™n.</p>
                 </div>
            </div>
            
            <h2 class="PAGE-TITLE-BM mt-8 border-b border-gray-300 pb-2"><i class="fas fa-clipboard-list"></i> L·ªäCH S·ª¨ THAO T√ÅC (LOG)</h2>
            <div id="GlobalLogDisplay">
                </div>
            
            </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        // ƒê·ªãa ch·ªâ m√°y ch·ªß C++ API (Crow/Pistache) c·ªßa b·∫°n
        const API_BASE_URL = 'http://localhost:8080/api/'; 
        // L·∫§Y ELEMENT M·ªöI
        const GLOBAL_LOG_DISPLAY = document.getElementById('GlobalLogDisplay');
        let CURRENT_MODULE = 'DOCTOR'; 
        let isConnectionErrorShown = false; 

        function LOG_MESSAGE(message, type = 'info') {
            const TIMESTAMP = new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            
            // T·∫°o m·ªôt th·∫ª div/p m·ªõi cho log
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            
            // X√≥a ti·ªÅn t·ªë console c≈© ">" v√† th√™m icon thay th·∫ø
            let prefix = '';
            if (type === 'error') {
                prefix = '<i class="FAS FA-EXCLAMATION-TRIANGLE"></i> L·ªñI: ';
            } else if (type === 'success') {
                prefix = '<i class="FAS FA-CHECK-CIRCLE"></i> ';
            } else if (type === 'warning') {
                prefix = '<i class="FAS FA-EXCLAMATION-CIRCLE"></i> ';
            } else {
                prefix = '<i class="FAS FA-TERMINAL"></i> ';
            }
            
            // Ch√®n n·ªôi dung log
            logEntry.innerHTML = `${prefix} **[${TIMESTAMP}]** ${message}`;
            
            // Th√™m v√†o ƒë·∫ßu khu v·ª±c log ƒë·ªÉ log m·ªõi nh·∫•t hi·ªán l√™n tr√™n
            if (GLOBAL_LOG_DISPLAY.firstChild) {
                GLOBAL_LOG_DISPLAY.insertBefore(logEntry, GLOBAL_LOG_DISPLAY.firstChild);
            } else {
                GLOBAL_LOG_DISPLAY.appendChild(logEntry);
            }
            
            // Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng log hi·ªÉn th·ªã (v√≠ d·ª•: 50 d√≤ng)
            while (GLOBAL_LOG_DISPLAY.children.length > 50) {
                GLOBAL_LOG_DISPLAY.removeChild(GLOBAL_LOG_DISPLAY.lastChild);
            }
        }
        
        // C·∫≠p nh·∫≠t h√†m x·ª≠ l√Ω l·ªói k·∫øt n·ªëi ƒë·ªÉ s·ª≠ d·ª•ng LOG_MESSAGE
        function SHOW_CONNECTION_ERROR(msg) {
             if (isConnectionErrorShown) return;
             // S·ª≠ d·ª•ng LOG_MESSAGE v·ªõi type 'error'
             LOG_MESSAGE(`**L·ªñI K·∫æT N·ªêI:** ${msg}. VUI L√íNG ƒê·∫¢M B·∫¢O m√°y ch·ªß C++ (localhost:8080) ƒëang ch·∫°y.`, 'error');
             isConnectionErrorShown = true;
        }

        function SEARCH_GLOBAL() {
            const query = document.getElementById('GLOBAL_SEARCH_INPUT').value;
            if (!query) return LOG_MESSAGE("VUI L√íNG NH·∫¨P T·ª™ KH√ìA T√åM KI·∫æM.", 'warning');
            alert(`ƒêang t√¨m ki·∫øm to√†n c·ª•c cho: "${query}"`);
        }

        function ALERT(message) {
            alert(message);
        }

        // H√†m x·ª≠ l√Ω form submit - M·ªöI TH√äM
        function handleFormSubmit(event, module) {
            event.preventDefault(); // QUAN TR·ªåNG: ngƒÉn reload trang
            event.stopPropagation(); // NgƒÉn s·ª± ki·ªán lan truy·ªÅn
            
            // G·ªçi API v·ªõi th√¥ng tin t·ª´ form
            CALL_API(module, window.FORM_MODE === 'ADD' ? 'ADD' : 'UPDATE');
            
            // NgƒÉn form submit m·∫∑c ƒë·ªãnh
            return false;
        }

        const MODULE_CONFIG = {
    'DOCTOR': { 
        plural: 'doctors', 
        name: 'B√ÅC Sƒ®', 
        fields: ['id','name','specialty','phone','email']
    },
    'NURSE': { 
        plural: 'nurses', 
        name: 'Y T√Å', 
        fields: ['id','name','position','phone','email'] 
    },
    'PATIENT': { 
        plural: 'patients', 
        name: 'B·ªÜNH NH√ÇN', 
        fields: ['id','name','dateOfBirth','phone','email'] 
    },
    'APPOINTMENT': { 
        plural: 'appointments', 
        name: 'L·ªäCH H·∫∏N', 
        fields: ['id','patientId','doctorId','typeName','date','time','status'],
        types: [
            { value: 'Kh√°m t·ªïng qu√°t', label: 'Kh√°m t·ªïng qu√°t' },
            { value: 'C·∫•p c·ª©u', label: 'C·∫•p c·ª©u' },
            { value: 'Ph·∫´u thu·∫≠t', label: 'Ph·∫´u thu·∫≠t' }
        ]
    },
    'TREATMENT': { 
        plural: 'treatments', 
        name: 'ƒêI·ªÄU TR·ªä', 
        fields: ['id','patientId','typeName','date','notes','status'],
        types: [
            { value: 'V·∫≠t l√Ω tr·ªã li·ªáu', label: 'V·∫≠t l√Ω tr·ªã li·ªáu' },
            { value: 'ƒêi·ªÅu tr·ªã thu·ªëc', label: 'ƒêi·ªÅu tr·ªã thu·ªëc' },
            { value: 'Ph·∫´u thu·∫≠t', label: 'Ph·∫´u thu·∫≠t' }
        ]
    }
};

        // H√†m t·ªïng h·ª£p Form/Buttons d·ª±a tr√™n Module - ƒê√É S·ª¨A FORM SUBMIT
        function RENDER_MODULE_UI(module) {
            const config = MODULE_CONFIG[module];
            const area = document.getElementById('MAIN_FUNCTION_AREA');
            const titleElement = document.querySelector('.PAGE-TITLE-BM');
            
            area.innerHTML = '';
            
            // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ trang
            if (titleElement) titleElement.textContent = `QU·∫¢N L√ù ${config.name} (MODULE ${module})`;

            // T·∫°o Form/Button HTML ‚Äî ƒê√É S·ª¨A FORM SUBMIT
            const html = `
                <div id="Form${module}AddUpdate" class="p-4 bg-white rounded-lg shadow-md mb-6 border-l-4 border-[var(--ACCENT-MINT)]" style="display: none;">
                    <h2 class="font-semibold text-lg mb-4 text-[var(--MINT-DARK)]" id="FormTitle">NH·∫¨P TH√îNG TIN M·ªöI</h2>
                    <form id="${module.toLowerCase()}_form" class="grid grid-cols-2 gap-x-6 gap-y-3" onsubmit="handleFormSubmit(event, '${module}')">
                        ${config.fields.map(field => `
                            <div class="col-span-1 flex items-center">
                                <label for="${module}_${field}_input" class="w-28 text-sm font-medium text-gray-700 uppercase">${field}:</label>
                                <input type="text" id="${module}_${field}_input" name="${field}" ${field === 'id' || field === 'name' ? 'required' : ''} class="flex-grow p-2 border border-gray-300 rounded-md text-sm">
                            </div>
                        `).join('')}
                        <button type="submit" class="col-span-2 ACTION-BTN-BM BG-MINT-ACCENT mt-4"><i class="FAS FA-SAVE"></i> L∆ØU V√ÄO H·ªÜ TH·ªêNG</button>
                    </form>
                </div>
                
                <div id="${module}ActionButtons" class="p-4 bg-white rounded-lg shadow-md">
                    <h2 class="font-semibold text-lg mb-4 text-[var(--MINT-DARK)]">CH·ª®C NƒÇNG (MENU ${module})</h2>
                    <div class="flex flex-wrap gap-3">
    <button class="ACTION-BTN-BM BG-MINT-ACCENT" onclick="CALL_API('${module}', 'LIST')">
        <i class="FAS FA-LIST-ALT"></i> 1. DANH S√ÅCH ${config.name}
    </button>
    <button class="ACTION-BTN-BM BG-MINT-ACCENT" onclick="SHOW_FORM_MODE('${module}', 'ADD')">
        <i class="FAS FA-USER-PLUS"></i> 2. TH√äM ${config.name} M·ªöI
    </button>
    <button class="ACTION-BTN-BM BG-SKY-ACCENT" onclick="CALL_API_WITH_ID('${module}', 'SEARCH')">
        <i class="FAS FA-SEARCH"></i> 3. T√åM KI·∫æM B·∫∞NG ID
    </button>
    <button class="ACTION-BTN-BM BG-RED-PASTEL" onclick="CALL_API_WITH_ID('${module}', 'REMOVE')">
        <i class="FAS FA-USER-TIMES"></i> 4. X√ìA
    </button>
    <button class="ACTION-BTN-BM BG-SKY-ACCENT" onclick="SHOW_FORM_MODE('${module}', 'UPDATE')">
        <i class="FAS FA-USER-EDIT"></i> 5. C·∫¨P NH·∫¨T TH√îNG TIN
    </button>
</div>
                </div>
            `;
            area.innerHTML = html;
            // T·ª± ƒë·ªông t·∫£i danh s√°ch khi chuy·ªÉn Module
            CALL_API(module, 'LIST', null, true);
        }

        function SHOW_FORM_MODE(module, mode) {
            window.FORM_MODE = mode; 
            const formContainer = document.getElementById(`Form${module}AddUpdate`);
            const formTitle = document.getElementById('FormTitle');

            // ·∫®n/Hi·ªán form
            const isVisible = formContainer.style.display !== 'none';
            if (isVisible && window.FORM_MODE === mode) {
                 formContainer.style.display = 'none';
                 return;
            }

            if (formContainer) {
                formContainer.style.display = 'block';
                formTitle.textContent = mode === 'ADD' ? `NH·∫¨P TH√îNG TIN ${MODULE_CONFIG[module].name} M·ªöI` : `C·∫¨P NH·∫¨T ${MODULE_CONFIG[module].name} (NH·∫¨P ID V√ÄO √î TR√äN)`;
                
                // reset all inputs of this module form
                MODULE_CONFIG[module].fields.forEach(f => {
                    const el = document.getElementById(`${module}_${f}_input`);
                    if (el) el.value = '';
                });

                // If update mode, prefill id from top input (user will fill other fields)
                if (mode === 'UPDATE') {
                    const topId = document.getElementById('action_id_input').value;
                    if (topId) {
                        const idEl = document.getElementById(`${module}_id_input`);
                        if (idEl) idEl.value = topId;
                    }
                }
            }
        }
        
        function LOADPAGE(module) {
            CURRENT_MODULE = module;
            document.querySelectorAll('.NAV-ITEM-BM').forEach(li => li.classList.remove('active'));
            document.querySelector(`[onclick="LOADPAGE('${module}')"]`).closest('li').classList.add('active');
            
            RENDER_MODULE_UI(module);
        }

        function COLLECT_DATA_FROM_FORM(module) {
            const config = MODULE_CONFIG[module];
            const data = {};
            
            if (window.FORM_MODE === 'UPDATE') {
                const topId = document.getElementById('action_id_input').value;
                data.id = topId || (document.getElementById(`${module}_id_input`) ? document.getElementById(`${module}_id_input`).value : '');
                if (!data.id) {
                    LOG_MESSAGE('CH·∫æ ƒê·ªò C·∫¨P NH·∫¨T C·∫¶N ID T·ª™ √î TR√äN C√ôNG!', 'warning');
                    return null;
                }
            }

            for (const field of config.fields) {
                const el = document.getElementById(`${module}_${field}_input`);
                if (el && el.value !== undefined) {
                    // parse dateOfBirth if needed? keep as string ‚Äî server expects string
                    data[field] = (field === 'dateOfBirth') ? el.value : el.value;
                }
            }

           if (window.FORM_MODE === 'ADD' && ['DOCTOR', 'NURSE', 'PATIENT'].includes(window.CURRENT_MODULE)) {
    if (!data.name || !data.name.trim()) {
        LOG_MESSAGE('T√äN L√Ä TR∆Ø·ªúNG B·∫ÆT BU·ªòC!', 'warning');
        return null;
    }
}

            
            return data;
        }

        // H√†m format JSON th√†nh HTML Table 
        function FORMAT_TO_TABLE(data, title) {
    const container = document.getElementById('DataDisplayContent');
    const titleElement = document.getElementById('DataDisplayTitle');

    titleElement.textContent = title;

    if (!Array.isArray(data) || data.length === 0) {
        container.innerHTML = `<p class="text-gray-500 mt-4 p-4 bg-white rounded-lg border">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu n√†o.</p>`;
        return;
    }

    const dataKeys = Object.keys(data[0]);
    let tableHTML = `<table class="DATA-DISPLAY-TABLE w-full border-collapse"><thead><tr class="bg-gray-100">`;

    // Header
    tableHTML += dataKeys.map(k => `<th class="p-2 text-left border-b">${k.toUpperCase()}</th>`).join('');
    tableHTML += `</tr></thead><tbody>`;

    // Rows
    tableHTML += data.map(item => {
        const rowHTML = dataKeys.map(k => {
            let val = item[k];

            if (val === undefined || val === null) return 'N/A';

            // N·∫øu l√† object, l·∫•y name n·∫øu c√≥, n·∫øu kh√¥ng th√¨ stringify
            if (typeof val === 'object') {
                if (val.name) return val.name;
                return JSON.stringify(val);
            }

            return val;
        }).map(v => `<td class="p-2 align-top border-b">${v}</td>`).join('');

        return `<tr class="even:bg-gray-50">${rowHTML}</tr>`;
    }).join('');

    tableHTML += `</tbody></table>`;
    container.innerHTML = tableHTML;
}

        function CALL_API_WITH_ID(module, action) {
            const id = document.getElementById('action_id_input').value; 
            if (!id || id.trim() === '') {
                LOG_MESSAGE('VUI L√íNG NH·∫¨P ID V√ÄO √î "ID/T·ª™ KH√ìA" TR√äN C√ôNG.', 'warning');
                return;
            }
            CALL_API(module, action, id);
        }

        async function CALL_API(module, action, targetId = null, isAutoLoad = false) {
            const config = MODULE_CONFIG[module];
            const MODULE_PLURAL = config.plural;
            const ACTION = action.toLowerCase();
            let dataToSend = null;
            let method = 'GET';
            let endpoint = API_BASE_URL + MODULE_PLURAL; 

            // X·ª¨ L√ù ENDPOINT D·ª∞A TR√äN H√ÄNH ƒê·ªòNG
            if (ACTION === 'add') { 
                method = 'POST';
                dataToSend = COLLECT_DATA_FROM_FORM(module);
                if (!dataToSend) return; 
            } else if (ACTION === 'update') { 
                method = 'PUT';
                dataToSend = COLLECT_DATA_FROM_FORM(module);
                if (!dataToSend || !dataToSend.id) return; 
                endpoint += `/${dataToSend.id}`; 
            } else if (targetId) { 
                endpoint += `/${targetId}`;
                if (ACTION === 'remove') {
                    method = 'DELETE';
                    if (!confirm(`B·∫†N C√ì CH·∫ÆC MU·ªêN X√ìA ${config.name} ID: ${targetId}?`)) return;
                }else if (ACTION === 'search') {
                    method = 'GET';
                }
            } else if (ACTION !== 'list') {
                 LOG_MESSAGE(`H√ÄNH ƒê·ªòNG ${ACTION.toUpperCase()} Y√äU C·∫¶U ID.`, 'warning');
                 return; 
            }
        
            // C·∫¨P NH·∫¨T LOG
            if (!isAutoLoad) LOG_MESSAGE(`G·ªåI API: ${endpoint} [${method}]...`);

            try {
                const response = await fetch(endpoint, { 
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: dataToSend ? JSON.stringify(dataToSend) : null
                });

                const status = response.status;
                const data = await response.json().catch(() => ({ message: 'Kh√¥ng c√≥ n·ªôi dung ph·∫£n h·ªìi JSON' }));

                if (status >= 200 && status < 300) {
                    // ·∫®N FORM SAU KHI TH√ÄNH C√îNG - ƒê√É DI CHUY·ªÇN ƒê·∫æN ƒê√ÇY
                    if (ACTION === 'add' || ACTION === 'update') {
                        const formContainer = document.getElementById(`Form${module}AddUpdate`);
                        if(formContainer) formContainer.style.display = 'none';
                    }

                    if (ACTION === 'list') {
                        FORMAT_TO_TABLE(data, `DANH S√ÅCH ${config.name} (${data.length} M·ª§C)`);
                    } else if (ACTION === 'search') {
                        FORMAT_TO_TABLE(Array.isArray(data) ? data : [data], `K·∫æT QU·∫¢ T√åM KI·∫æM CHO ID: ${targetId}`);
                    } else if (ACTION === 'add') {
                        // hi·ªÉn th·ªã b·∫£n ghi v·ª´a l∆∞u l√™n m√†n h√¨nh
                        FORMAT_TO_TABLE(Array.isArray(data) ? data : [data], `ƒê√É TH√äM ${config.name.toUpperCase()}`);
                        LOG_MESSAGE(`TH√äM ${config.name} TH√ÄNH C√îNG (ID: ${data.id || 'N/A'})`, 'success');
                    } else if (ACTION === 'update') {
                        FORMAT_TO_TABLE(Array.isArray(data) ? data : [data], `ƒê√É C·∫¨P NH·∫¨T ${config.name.toUpperCase()}`);
                        LOG_MESSAGE(`C·∫¨P NH·∫¨T ${config.name} TH√ÄNH C√îNG (ID: ${data.id || 'N/A'})`, 'success');
                    } else {
                        // C·∫¨P NH·∫¨T LOG
                        LOG_MESSAGE(`THAO T√ÅC ${ACTION.toUpperCase()} TH√ÄNH C√îNG! M√£: ${status}.`, 'success');
                        // T·ª∞ ƒê·ªòNG G·ªåI LIST ƒë·ªÉ refresh
                        CALL_API(module, 'LIST', null, true); 
                    }
                } else {
                    const errorMsg = data.error || data.message || "L·ªñI KH√îNG X√ÅC ƒê·ªäNH.";
                    // C·∫¨P NH·∫¨T LOG
                    LOG_MESSAGE(`L·ªñI SERVER (${status}): ${errorMsg}`, 'error');
                }

            } catch (error) {
                // C·∫¨P NH·∫¨T LOG
                LOG_MESSAGE(`L·ªñI M·∫†NG/K·∫æT N·ªêI: Failed to fetch. Chi ti·∫øt: ${error.message}. KI·ªÇM TRA M√ÅY CH·ª¶ C++!`, 'error');
                SHOW_CONNECTION_ERROR(`L·ªói m·∫°ng. Chi ti·∫øt: ${error.message}`);
            }
        }

        // T·∫¢I N·ªòI DUNG M·∫∂C ƒê·ªäNH
        document.addEventListener('DOMContentLoaded', () => {
            LOADPAGE('DOCTOR'); 
            // C·∫¨P NH·∫¨T LOG
            LOG_MESSAGE('CH∆Ø∆†NG TR√åNH ƒê√É KH·ªûI ƒê·ªòNG.', 'success');
            LOG_MESSAGE('H·ªÜ TH·ªêNG GIAO TI·∫æP S·∫¥N S√ÄNG. VUI L√íNG NH·∫§P N√öT.');
        });
    </script>
</body>
</html>